---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { themes } from "@/lib/themes";
import {
  ArrowRightIcon,
  DownloadSimpleIcon,
  GithubLogoIcon,
  PaperPlaneTiltIcon,
} from "@phosphor-icons/react";
import { ProjectsFall } from "@/components/projects/ProjectsFall";
import { JobsFall } from "@/components/jobs/JobsFall";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { SocialLinks } from "@/components/footer/SocialLinksLite";
import { ActionBtnLinks } from "@/components/data/actionBtn";
import { profileData } from "@/components/data/profile";

const allProjects = await getCollection("projects");
// 按 pin 和日期排序
const sortedProjects = allProjects.sort((a, b) => {
  if (a.data.pin && !b.data.pin) return -1;
  if (!a.data.pin && b.data.pin) return 1;
  return b.data.startDate.getTime() - a.data.startDate.getTime();
});

const allJobs = await getCollection("jobs");
// 按日期排序（正在進行中的工作排最前面，然後按開始日期倒序）
const sortedJobs = allJobs
  .sort((a, b) => {
    // 正在進行中的工作（endDate 為 null）排在最前面
    const aIsActive = !a.data.endDate;
    const bIsActive = !b.data.endDate;

    if (aIsActive && !bIsActive) return -1;
    if (!aIsActive && bIsActive) return 1;

    // 都是進行中或都已結束，按開始日期倒序排列
    const aDate = a.data.startDate?.getTime() || 0;
    const bDate = b.data.startDate?.getTime() || 0;
    return bDate - aDate;
  })
  .slice(0, 3);
---

<BaseLayout
  title="呂亮進・結合 AI 技術與設計思維的全端工程師"
  description="關於呂亮進 - AI 工程師、產品設計師、全端開發者"
  ogImage="/assets/MetaTagCover.png"
  headerType="main"
>
  <div class="min-h-screen bg-gradient-to-b from-gray-50 to-transparent pt-20">
    <!-- Hero Section -->
    <section class="container mx-auto px-4 pt-16 md:pt-24">
      <div class="max-w-6xl mx-auto text-center">
        <div class="grid items-center">
          <h1
            class="text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent tracking-wider leading-[1.5]"
          >
            具 AI 技術與設計思維的全端工程師
          </h1>
          <div class="overflow-hidden">
            <div class="overflow-hidden">
              <Card
                className="mt-12 transition-all duration-300 hover:mt-9 pb-4 hover:pb-7 inline-flex rounded-b-none"
              >
                <CardContent className="gap-6 items-center pt-3 pb-4">
                  <div
                    class="h-4 w-10 my-2 border rounded-full bg-[var(--theme-primary-10)] inset-shadow-sm"
                  >
                  </div>
                  <img
                    src="/assets/imgs/index/myHead.webp"
                    alt=`${profileData.name}的頭像`
                    class="size-32 rounded-full overflow-hidden"
                  />
                  <div class="px-4">
                    <p
                      class="text-xl md:text-2xl text-foreground font-bold mb-3"
                    >
                      {profileData.name}
                    </p>
                    <p class="text-muted-foreground mb-3">
                      {profileData.jobTitle}
                    </p>
                  </div>
                  <ActionBtnLinks />
                  <div>
                    <div class="flex px-1">
                      <SocialLinks />
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>
            <div class="h-1 border-t"></div>
          </div>
        </div>
      </div>

      <!-- Projects Section -->
      <section class="container mx-auto px-4 py-12">
        <div class="max-w-6xl mx-auto space-y-12">
          <div class="grid gap-4">
            <h2 class="text-3xl font-bold">工作經歷</h2>
            <JobsFall jobs={sortedJobs} themes={themes} />
            <div>
              <a href="/jobs/" class="mx-auto">
                <Button variant="outline" className="hover:[&>svg]:ms-1">
                  顯示所有工作經歷
                  <ArrowRightIcon className="transition-all duration-300" />
                </Button>
              </a>
            </div>
          </div>
          <div class="grid gap-4">
            <h2 class="text-3xl font-bold mb-8">專案作品</h2>
            <div class="max-w-6xl mx-auto">
              <ProjectsFall
                projects={sortedProjects}
                themes={themes}
                client:load
              />
            </div>
          </div>
        </div>
      </section>
    </section>

    <a href="mailto:liangchinlu@gmail.com">
      <button
        class="fixed bottom-28 right-6 w-16 h-16 md:bottom-30 md:right-8 rounded-full bg-[var(--theme-primary)] text-background flex items-center justify-center shadow-[0_4px_12px_rgba(0,0,0,0.15)] transition-all duration-300 ease-in-out z-[1000] cursor-pointer hover:bg-[var(--theme-secondary)] hover:-translate-y-1 hover:shadow-[0_6px_16px_rgba(0,0,0,0.2)] active:-translate-y-0.5"
        title="通知我"
      >
        <PaperPlaneTiltIcon className="size-8" />
      </button>
    </a>
  </div>
</BaseLayout>
