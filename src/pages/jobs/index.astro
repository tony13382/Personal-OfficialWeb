---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { themes } from "@/lib/themes";
import { JobsFall } from "@/components/jobs/JobsFall";
import {
  ProfileCard,
  ProfileCardModal,
  profileData,
} from "@/components/data/profile";

const allJobs = await getCollection("jobs");

// 按日期排序（正在進行中的工作排最前面，然後按開始日期倒序）
const sortedJobs = allJobs.sort((a, b) => {
  // 正在進行中的工作（endDate 為 null）排在最前面
  const aIsActive = !a.data.endDate;
  const bIsActive = !b.data.endDate;

  if (aIsActive && !bIsActive) return -1;
  if (!aIsActive && bIsActive) return 1;

  // 都是進行中或都已結束，按開始日期倒序排列
  const aDate = a.data.startDate?.getTime() || 0;
  const bDate = b.data.startDate?.getTime() || 0;
  return bDate - aDate;
});
---

<BaseLayout
  title="工作經歷 | 呂亮進"
  description="呂亮進的工作經歷 - AI 工程師、產品設計師、全端開發者"
  ogImage="/assets/MetaTagCover.png"
  headerType="main"
>
  <div class="min-h-screen bg-gradient-to-b from-gray-50 to-transparent pt-20">
    <!-- Jobs Section -->
    <section class="container mx-auto px-4 py-12">
      <div class="max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-4">
        <div class="relative">
          <div class="sticky top-0 pt-16">
            <ProfileCard />
          </div>
        </div>
        <div class="col-span-1 lg:col-span-2">
          <div class="mb-8 mt-5">
            <h1 class="text-4xl font-bold mb-2 flex items-center gap-3">
              得獎紀錄
            </h1>
          </div>

          <JobsFall jobs={sortedJobs} themes={themes} />
        </div>
      </div>
    </section>
  </div>

  <button
    id="profile-modal-btn"
    class="floatbtn fixed bottom-28 right-6 size-16 md:bottom-30 md:right-8 rounded-full bg-[var(--theme-primary)] text-background flex items-center justify-center shadow-[0_4px_12px_rgba(0,0,0,0.15)] opacity-0 invisible transition-all duration-300 ease-in-out z-40 cursor-pointer hover:bg-[var(--theme-secondary)] hover:-translate-y-1 hover:shadow-[0_6px_16px_rgba(0,0,0,0.2)] active:-translate-y-0.5 lg:hidden"
    title="通知我"
  >
    <img
      src="/assets/imgs/index/myHead.webp"
      alt={`${profileData.name}的頭像`}
      class="size-16 rounded-full overflow-hidden"
    />
  </button>

  <ProfileCardModal client:load />
</BaseLayout>
